import{Fb as X,Ib as tt,Jb as et,Kb as nt,Lb as z,Mb as rt,i as G,m as K}from"./chunk-B4R456B3.js";import{Ib as Q,e as lt,g as ht,j as O,ua as A}from"./chunk-DNCYZTAJ.js";var st=lt((W,q)=>{"use strict";(function(D,e){typeof W=="object"&&typeof q<"u"?q.exports=e():typeof define=="function"&&define.amd?define(e):(D=typeof globalThis<"u"?globalThis:D||self).dayjs=e()})(W,function(){"use strict";var D=1e3,e=6e4,u=36e5,c="millisecond",d="second",m="minute",y="hour",b="day",w="week",$="month",J="quarter",S="year",F="date",E="Invalid Date",at=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ot=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,ut={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(i){var r=["th","st","nd","rd"],t=i%100;return"["+i+(r[(t-20)%10]||r[t]||r[0])+"]"}},I=function(i,r,t){var s=String(i);return!s||s.length>=r?i:""+Array(r+1-s.length).join(t)+i},ct={s:I,z:function(i){var r=-i.utcOffset(),t=Math.abs(r),s=Math.floor(t/60),n=t%60;return(r<=0?"+":"-")+I(s,2,"0")+":"+I(n,2,"0")},m:function i(r,t){if(r.date()<t.date())return-i(t,r);var s=12*(t.year()-r.year())+(t.month()-r.month()),n=r.clone().add(s,$),a=t-n<0,o=r.clone().add(s+(a?-1:1),$);return+(-(s+(t-n)/(a?n-o:o-n))||0)},a:function(i){return i<0?Math.ceil(i)||0:Math.floor(i)},p:function(i){return{M:$,y:S,w,d:b,D:F,h:y,m,s:d,ms:c,Q:J}[i]||String(i||"").toLowerCase().replace(/s$/,"")},u:function(i){return i===void 0}},L="en",C={};C[L]=ut;var V="$isDayjsObject",P=function(i){return i instanceof N||!(!i||!i[V])},U=function i(r,t,s){var n;if(!r)return L;if(typeof r=="string"){var a=r.toLowerCase();C[a]&&(n=a),t&&(C[a]=t,n=a);var o=r.split("-");if(!n&&o.length>1)return i(o[0])}else{var h=r.name;C[h]=r,n=h}return!s&&n&&(L=n),n||!s&&L},p=function(i,r){if(P(i))return i.clone();var t=typeof r=="object"?r:{};return t.date=i,t.args=arguments,new N(t)},l=ct;l.l=U,l.i=P,l.w=function(i,r){return p(i,{locale:r.$L,utc:r.$u,x:r.$x,$offset:r.$offset})};var N=function(){function i(t){this.$L=U(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[V]=!0}var r=i.prototype;return r.parse=function(t){this.$d=function(s){var n=s.date,a=s.utc;if(n===null)return new Date(NaN);if(l.u(n))return new Date;if(n instanceof Date)return new Date(n);if(typeof n=="string"&&!/Z$/i.test(n)){var o=n.match(at);if(o){var h=o[2]-1||0,f=(o[7]||"0").substring(0,3);return a?new Date(Date.UTC(o[1],h,o[3]||1,o[4]||0,o[5]||0,o[6]||0,f)):new Date(o[1],h,o[3]||1,o[4]||0,o[5]||0,o[6]||0,f)}}return new Date(n)}(t),this.init()},r.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},r.$utils=function(){return l},r.isValid=function(){return this.$d.toString()!==E},r.isSame=function(t,s){var n=p(t);return this.startOf(s)<=n&&n<=this.endOf(s)},r.isAfter=function(t,s){return p(t)<this.startOf(s)},r.isBefore=function(t,s){return this.endOf(s)<p(t)},r.$g=function(t,s,n){return l.u(t)?this[s]:this.set(n,t)},r.unix=function(){return Math.floor(this.valueOf()/1e3)},r.valueOf=function(){return this.$d.getTime()},r.startOf=function(t,s){var n=this,a=!!l.u(s)||s,o=l.p(t),h=function(j,v){var k=l.w(n.$u?Date.UTC(n.$y,v,j):new Date(n.$y,v,j),n);return a?k:k.endOf(b)},f=function(j,v){return l.w(n.toDate()[j].apply(n.toDate("s"),(a?[0,0,0,0]:[23,59,59,999]).slice(v)),n)},g=this.$W,_=this.$M,M=this.$D,Y="set"+(this.$u?"UTC":"");switch(o){case S:return a?h(1,0):h(31,11);case $:return a?h(1,_):h(0,_+1);case w:var T=this.$locale().weekStart||0,H=(g<T?g+7:g)-T;return h(a?M-H:M+(6-H),_);case b:case F:return f(Y+"Hours",0);case y:return f(Y+"Minutes",1);case m:return f(Y+"Seconds",2);case d:return f(Y+"Milliseconds",3);default:return this.clone()}},r.endOf=function(t){return this.startOf(t,!1)},r.$set=function(t,s){var n,a=l.p(t),o="set"+(this.$u?"UTC":""),h=(n={},n[b]=o+"Date",n[F]=o+"Date",n[$]=o+"Month",n[S]=o+"FullYear",n[y]=o+"Hours",n[m]=o+"Minutes",n[d]=o+"Seconds",n[c]=o+"Milliseconds",n)[a],f=a===b?this.$D+(s-this.$W):s;if(a===$||a===S){var g=this.clone().set(F,1);g.$d[h](f),g.init(),this.$d=g.set(F,Math.min(this.$D,g.daysInMonth())).$d}else h&&this.$d[h](f);return this.init(),this},r.set=function(t,s){return this.clone().$set(t,s)},r.get=function(t){return this[l.p(t)]()},r.add=function(t,s){var n,a=this;t=Number(t);var o=l.p(s),h=function(_){var M=p(a);return l.w(M.date(M.date()+Math.round(_*t)),a)};if(o===$)return this.set($,this.$M+t);if(o===S)return this.set(S,this.$y+t);if(o===b)return h(1);if(o===w)return h(7);var f=(n={},n[m]=e,n[y]=u,n[d]=D,n)[o]||1,g=this.$d.getTime()+t*f;return l.w(g,this)},r.subtract=function(t,s){return this.add(-1*t,s)},r.format=function(t){var s=this,n=this.$locale();if(!this.isValid())return n.invalidDate||E;var a=t||"YYYY-MM-DDTHH:mm:ssZ",o=l.z(this),h=this.$H,f=this.$m,g=this.$M,_=n.weekdays,M=n.months,Y=n.meridiem,T=function(v,k,x,R){return v&&(v[k]||v(s,a))||x[k].slice(0,R)},H=function(v){return l.s(h%12||12,v,"0")},j=Y||function(v,k,x){var R=v<12?"AM":"PM";return x?R.toLowerCase():R};return a.replace(ot,function(v,k){return k||function(x){switch(x){case"YY":return String(s.$y).slice(-2);case"YYYY":return l.s(s.$y,4,"0");case"M":return g+1;case"MM":return l.s(g+1,2,"0");case"MMM":return T(n.monthsShort,g,M,3);case"MMMM":return T(M,g);case"D":return s.$D;case"DD":return l.s(s.$D,2,"0");case"d":return String(s.$W);case"dd":return T(n.weekdaysMin,s.$W,_,2);case"ddd":return T(n.weekdaysShort,s.$W,_,3);case"dddd":return _[s.$W];case"H":return String(h);case"HH":return l.s(h,2,"0");case"h":return H(1);case"hh":return H(2);case"a":return j(h,f,!0);case"A":return j(h,f,!1);case"m":return String(f);case"mm":return l.s(f,2,"0");case"s":return String(s.$s);case"ss":return l.s(s.$s,2,"0");case"SSS":return l.s(s.$ms,3,"0");case"Z":return o}return null}(v)||o.replace(":","")})},r.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},r.diff=function(t,s,n){var a,o=this,h=l.p(s),f=p(t),g=(f.utcOffset()-this.utcOffset())*e,_=this-f,M=function(){return l.m(o,f)};switch(h){case S:a=M()/12;break;case $:a=M();break;case J:a=M()/3;break;case w:a=(_-g)/6048e5;break;case b:a=(_-g)/864e5;break;case y:a=_/u;break;case m:a=_/e;break;case d:a=_/D;break;default:a=_}return n?a:l.a(a)},r.daysInMonth=function(){return this.endOf($).$D},r.$locale=function(){return C[this.$L]},r.locale=function(t,s){if(!t)return this.$L;var n=this.clone(),a=U(t,s,!0);return a&&(n.$L=a),n},r.clone=function(){return l.w(this.$d,this)},r.toDate=function(){return new Date(this.valueOf())},r.toJSON=function(){return this.isValid()?this.toISOString():null},r.toISOString=function(){return this.$d.toISOString()},r.toString=function(){return this.$d.toUTCString()},i}(),Z=N.prototype;return p.prototype=Z,[["$ms",c],["$s",d],["$m",m],["$H",y],["$W",b],["$M",$],["$y",S],["$D",F]].forEach(function(i){Z[i[1]]=function(r){return this.$g(r,i[0],i[1])}}),p.extend=function(i,r){return i.$i||(i(r,N,p),i.$i=!0),p},p.locale=U,p.isDayjs=P,p.unix=function(i){return p(1e3*i)},p.en=C[L],p.Ls=C,p.p={},p})});var B=ht(st());var it=class D{dayjs=B.default;request=A(X);modal=A(et);router=A(K);title=A(G);modelRef=A(tt,{optional:!0});pageComponent;page;_params;set params(e){this._params=e,this.load()}get params(){return this._params}content;isChild=!1;data=[];loading=!1;auto_refresh_interval=0;constructor(){}ngAfterViewInit(){this.init()}ngOnInit(){}ngOnDestroy(){this.unmount()}mount(){if(this.onMount?.call(this),typeof this.content?.auto_refresh=="number"&&this.content.auto_refresh>0&&(this.auto_refresh_interval=setInterval(()=>this.load(),this.content.auto_refresh*1e3)),typeof this.content?.mount=="string"&&this.content.mount.length>0)try{this.content.mount=new Function(this.content.mount)}catch(e){console.error(e)}O(this.content?.mount)&&this.content?.mount.call(this)}unmount(){if(this.onUnmount?.call(this),this.auto_refresh_interval&&clearInterval(this.auto_refresh_interval),typeof this.content?.unmount=="string"&&this.content.unmount.length>0)try{this.content.unmount=new Function(this.content.unmount)}catch(e){console.error(e)}O(this.content?.unmount)&&this.content?.unmount.call(this)}init(){this.content?(this.build(),this.mount(),this.load()):this.page&&this.load_page()}load_page(){console.log("[base] load page",this.page);let e="page/"+this.page;this.request.get(e).subscribe(u=>{u.error||(this.content=u,this.content?.title&&!this.isChild&&!this.modelRef&&this.title.setTitle(this.content.title),this.build(),this.mount(),this.load())})}build(){console.log("[base] build"),this.content?.methods!=null&&Object.keys(this.content.methods).forEach(e=>{let u=this.content?.methods?.[e];if(typeof u=="string")try{let c=new Function(u);c.bind(this),this[e]=c}catch(c){console.error(c)}else if(Array.isArray(u))try{let c=new Function(...u);c.bind(this),this[e]=c}catch(c){console.error(c)}else this[e]=u})}render(e){setTimeout(()=>{this.data=e})}load(){if(console.log("[base] load data",this.page),!!this.content&&(this.content.data&&this.render(this.content.data),this.content.load_api)){this.loading=!0;let e=z(this.content.load_api,this.params);this.request.get(e).subscribe(u=>{if(!u.error){if(this.render(u.data),typeof this.content?.load_success=="string"&&this.content.load_success.length>0)try{this.content.load_success=new Function("data",this.content.load_success)}catch(c){console.error(c)}O(this.content?.load_success)&&this.content?.load_success.call(this,u.data)}}).add(()=>{this.loading=!1})}}navigate(e){this.router.navigateByUrl(e).then()}execute(e,u,c){if(!e)return;let d=this.get_action_params(e,u||this.data,c||0);switch(e.type){case"link":let m=this.get_action_link(e,u||this.data,c||0),y=new URLSearchParams(d).toString(),b=m+"?"+y;e.external?window.open(b):this.router.navigateByUrl(b);break;case"script":if(typeof e.script=="string"&&e.script.length>0)try{e.script=new Function("data","index",e.script)}catch(w){console.error(w)}O(e.script)&&e.script.call(this,u||this.data,c||0);break;case"page":this.router.navigate(["/page/"+e.page],{queryParams:d});break;case"dialog":this.modal.create({nzContent:rt,nzWidth:"80%",nzData:{page:e.page,params:d},nzFooter:null}).afterClose.subscribe(w=>{if(typeof e.after_close=="string"&&e.after_close.length>0)try{e.after_close=new Function("result","data","index",e.after_close)}catch($){console.error($)}O(e.after_close)&&e.after_close.call(this,w,u||this.data,c||0)});break}}get_action_link(e,u,c){if(!e.link)return"";let d=z(e.link,u);if(typeof e.link_func=="string"&&e.link_func.length>0)try{e.link_func=new Function(e.link_func)}catch(m){console.error(m)}return O(e.link_func)&&(d=e.link_func.call(this,u,c)),d}get_action_params(e,u,c){let d=e.params;if(typeof e.params_func=="string"&&e.params_func.length>0)try{e.params_func=new Function("data",e.params_func)}catch(m){console.error(m)}return O(e.params_func)&&(d=e.params_func.call(this,u,c)),d}export_json(e,u){let c=JSON.stringify(e,null,"	"),d=new Blob([c],{type:"application/json"}),m=URL.createObjectURL(d),y=document.createElement("a");y.href=m,y.download=u+(0,B.default)().format("-YYYYMMDDHHmmss")+".json",document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(m)}import_json(){return new Promise((e,u)=>{let c=document.createElement("input");c.type="file",c.click(),c.onchange=d=>{let m=d.target?.files?.[0];if(m){let y=new FileReader;y.onload=function(b){let w=b.target?.result||"";try{let $=JSON.parse(w.toString());e($)}catch($){u($)}},y.readAsText(m)}}})}static \u0275fac=function(u){return new(u||D)};static \u0275cmp=Q({type:D,selectors:[["app-template"]],inputs:{page:"page",content:"content",params:"params",data:"data",isChild:"isChild",pageComponent:"pageComponent"},decls:0,vars:0,template:function(u,c){},dependencies:[nt],encapsulation:2})};export{st as a,it as b};
