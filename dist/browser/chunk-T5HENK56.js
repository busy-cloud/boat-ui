import{a as ft,b as xt}from"./chunk-LL6PE2IQ.js";import{a as ut,b as Ct}from"./chunk-Y45U2NPN.js";import{b as bt}from"./chunk-XRY6KIPZ.js";import"./chunk-5TB5GV2Z.js";import{$ as mt,B as X,S as Z,T as tt,U as et,V as nt,W as it,X as ot,Y as at,Z as rt,_ as lt,r as G}from"./chunk-GOYYEOLK.js";import{Fb as ct,Hb as pt,Jb as _t,Kb as st,Lb as dt,V as H,m as K,nb as U,qa as N,yb as Y}from"./chunk-BJS2GJXO.js";import{Ab as v,Cc as h,Dc as c,Dd as L,Ec as D,Ed as W,Fa as u,Fc as d,Fd as J,Ga as f,Hd as P,Ia as q,Ib as k,Mb as R,Mc as A,Oa as E,Ob as p,Qc as g,Rc as w,Sc as M,Ub as r,Vc as F,bc as T,gc as m,hc as s,ic as x,j as Q,mc as C,pc as b,rc as o,vb as l,wc as V,xc as O,yc as B,yd as j,zd as I}from"./chunk-DNCYZTAJ.js";var St=()=>[];function ht(e,i){if(e&1&&(m(0,"th",6),c(1),s()),e&2){let t=i.$implicit;r("nzColumnKey",t.key)("nzShowSort",t.sortable)("nzSortFn",!0)("nzShowFilter",!!t.filter)("nzFilterFn",!0)("nzFilters",t.filter||A(7,St)),l(),d(" ",t.label," ")}}function vt(e,i){e&1&&(m(0,"th"),c(1,"\u64CD\u4F5C"),s())}function kt(e,i){if(e&1&&(c(0),g(1,"date")),e&2){let t=o().$implicit,n=o().$implicit;d(" ",M(1,1,n[t.key],t.format||"yyyy-MM-dd HH:mm:ss")," ")}}function wt(e,i){if(e&1&&(c(0),g(1,"number")),e&2){let t=o().$implicit,n=o().$implicit;d(" ",M(1,1,n[t.key],t.format||"1.0-2")," ")}}function Ft(e,i){if(e&1&&(c(0),g(1,"nzBytes")),e&2){let t=o().$implicit,n=o().$implicit;d(" ",w(1,1,n[t.key])," ")}}function It(e,i){if(e&1&&c(0),e&2){let t=o().$implicit,n=o().$implicit;d(" ",n[t.key]?"\u662F":"\u5426"," ")}}function Pt(e,i){if(e&1&&c(0),e&2){let t=o().$implicit,n=o().$implicit;d(" ",n[t.key]?"\u662F":"\u5426"," ")}}function Nt(e,i){if(e&1&&x(0,"nz-progress",9),e&2){let t=o().$implicit,n=o().$implicit,a=o();r("nzPercent",a.parseInt(n[t.key]))}}function $t(e,i){if(e&1&&(m(0,"nz-tag"),c(1),s()),e&2){let t=i.$implicit;l(),D(t)}}function Et(e,i){if(e&1&&p(0,$t,2,1,"nz-tag",5),e&2){let t=o().$implicit,n=o().$implicit;r("ngForOf",n[t.key])}}function Vt(e,i){if(e&1&&(c(0),g(1,"json")),e&2){let t=o().$implicit,n=o().$implicit;d(" ",w(1,1,n[t.key])," ")}}function Ot(e,i){if(e&1&&(c(0),g(1,"json")),e&2){let t=o().$implicit,n=o().$implicit;d(" ",w(1,1,n[t.key])," ")}}function Bt(e,i){if(e&1&&x(0,"nz-avatar",10),e&2){let t=o().$implicit,n=o().$implicit;r("nzSrc",n[t.key])}}function Dt(e,i){if(e&1&&x(0,"nz-avatar",11),e&2){let t=o().$implicit,n=o().$implicit;r("nzSrc",n[t.key])}}function Mt(e,i){if(e&1){let t=C();m(0,"a",12),b("click",function(){u(t);let a=o(2).$implicit,_=o(),z=_.$implicit,y=_.index,S=o();return f(S.action.emit({action:a.action,data:z,index:y}))}),c(1),s()}if(e&2){let t=o(2).$implicit,n=o().$implicit;l(),D(n[t.key])}}function Qt(e,i){if(e&1&&c(0),e&2){let t=o(2).$implicit,n=o().$implicit;d(" ",n[t.key]," ")}}function qt(e,i){if(e&1&&p(0,Mt,2,1,"a")(1,Qt,1,1),e&2){let t=o().$implicit;T(t.action?0:1)}}function Rt(e,i){if(e&1&&(m(0,"td",8),p(1,kt,2,4)(2,wt,2,4)(3,Ft,2,3)(4,It,1,1)(5,Pt,1,1)(6,Nt,1,1,"nz-progress",9)(7,Et,1,1,"nz-tag")(8,Vt,2,3)(9,Ot,2,3)(10,Bt,1,1,"nz-avatar",10)(11,Dt,1,1,"nz-avatar",11)(12,qt,2,1),s()),e&2){let t,n=i.$implicit;r("nzEllipsis",n.ellipsis)("nzBreakWord",n.break),l(),T((t=n.type)==="date"?1:t==="number"?2:t==="bytes"?3:t==="bool"?4:t==="boolean"?5:t==="progress"?6:t==="tags"?7:t==="json"?8:t==="object"?9:t==="icon"?10:t==="avatar"?11:12)}}function At(e,i){if(e&1&&x(0,"i",19),e&2){let t=o(2).$implicit;r("nzType",t.icon)}}function jt(e,i){if(e&1){let t=C();m(0,"a",17),b("nzOnConfirm",function(){u(t);let a=o().$implicit,_=o(2),z=_.$implicit,y=_.index,S=o();return f(S.action.emit({action:a.action,data:z,index:y}))}),p(1,At,1,1,"i",18),c(2),s()}if(e&2){let t=o().$implicit;r("title",t.title||"")("nzPopconfirmTitle",t.confirm),l(),r("ngIf",t.icon),l(),d("",t.label," ")}}function Lt(e,i){if(e&1&&x(0,"i",19),e&2){let t=o(2).$implicit;r("nzType",t.icon)}}function Wt(e,i){if(e&1){let t=C();m(0,"a",20),b("click",function(){u(t);let a=o().$implicit,_=o(2),z=_.$implicit,y=_.index,S=o();return f(S.action.emit({action:a.action,data:z,index:y}))}),p(1,Lt,1,1,"i",18),c(2),s()}if(e&2){let t=o().$implicit;r("title",t.title||""),l(),r("ngIf",t.icon),l(),d("",t.label," ")}}function Jt(e,i){if(e&1&&(m(0,"span",14),p(1,jt,3,4,"a",15)(2,Wt,3,3,"a",16),s()),e&2){let t=i.$implicit;l(),T(t.confirm?1:2)}}function Kt(e,i){if(e&1&&(m(0,"td"),p(1,Jt,3,1,"span",13),s()),e&2){let t=o(2);l(),r("ngForOf",t.operators)}}function Ht(e,i){if(e&1&&(m(0,"tr"),p(1,Rt,13,3,"td",7)(2,Kt,2,1,"td",4),s()),e&2){let t=o();l(),r("ngForOf",t.columns),l(),r("ngIf",t.operators&&t.operators.length)}}function Gt(e,i){if(e&1&&c(0),e&2){let t=i.$implicit;d("\u603B\u8BA1 ",t," \u6761")}}var $=class e{constructor(i,t,n){this.router=i;this.ms=t;this.request=n}pageSize=20;pageIndex=1;columns=[];operators;datum=[];total=0;loading=!1;query=new E;action=new E;body={filter:{}};ngOnInit(){}onQuery(i){i.filter.forEach(n=>{n.value&&(n.value.length>1?this.body.filter[n.key]=n.value:n.value.length===1&&(this.body.filter[n.key]=n.value[0]))}),this.body.skip=(i.pageIndex-1)*i.pageSize,this.body.limit=i.pageSize;let t=i.sort.filter(n=>n.value);t.length?(this.body.sort={},t.forEach(n=>{this.body.sort[n.key]=n.value==="ascend"?1:-1})):delete this.body.sort,this.query.emit(this.body)}parseInt=parseInt;static \u0275fac=function(t){return new(t||e)(v(K),v(_t),v(ct))};static \u0275cmp=k({type:e,selectors:[["smart-table"]],inputs:{pageSize:"pageSize",columns:"columns",operators:"operators",datum:"datum",total:"total",loading:"loading"},outputs:{query:"query",action:"action"},decls:10,vars:13,consts:[["table",""],["totalTemplate",""],["nzSize","small",3,"nzQueryParams","nzData","nzLoading","nzShowPagination","nzShowTotal","nzFrontPagination","nzPageIndex","nzPageSize","nzTotal","nzShowQuickJumper","nzShowSizeChanger"],[3,"nzColumnKey","nzShowSort","nzSortFn","nzShowFilter","nzFilterFn","nzFilters",4,"ngFor","ngForOf"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"nzColumnKey","nzShowSort","nzSortFn","nzShowFilter","nzFilterFn","nzFilters"],[3,"nzEllipsis","nzBreakWord",4,"ngFor","ngForOf"],[3,"nzEllipsis","nzBreakWord"],[3,"nzPercent"],["nzShape","square","nzIcon","file-image",3,"nzSrc"],["nzIcon","user",3,"nzSrc"],[3,"click"],["class","operator",4,"ngFor","ngForOf"],[1,"operator"],["nz-popconfirm","",3,"title","nzPopconfirmTitle"],[3,"title"],["nz-popconfirm","",3,"nzOnConfirm","title","nzPopconfirmTitle"],["nz-icon","",3,"nzType",4,"ngIf"],["nz-icon","",3,"nzType"],[3,"click","title"]],template:function(t,n){if(t&1){let a=C();m(0,"nz-table",2,0),b("nzQueryParams",function(z){return u(a),f(n.onQuery(z))}),m(2,"thead")(3,"tr"),p(4,ht,2,8,"th",3)(5,vt,2,0,"th",4),s()(),m(6,"tbody"),p(7,Ht,3,2,"tr",5),s()(),p(8,Gt,1,1,"ng-template",null,1,F)}if(t&2){let a=h(1),_=h(9);r("nzData",n.datum)("nzLoading",n.loading)("nzShowPagination",!0)("nzShowTotal",_)("nzFrontPagination",!1)("nzPageIndex",n.pageIndex)("nzPageSize",n.pageSize)("nzTotal",n.total)("nzShowQuickJumper",!0)("nzShowSizeChanger",!0),l(4),r("ngForOf",n.columns),l(),r("ngIf",n.operators&&n.operators.length),l(2),r("ngForOf",a.data)}},dependencies:[P,j,I,W,J,L,G,mt,at,tt,Z,et,lt,ot,rt,it,nt,ut,st,N,pt,X,ft,xt],styles:[".operator[_ngcontent-%COMP%]{padding:0 2px}"]})};var Ut=["toolbar"],Xt=["table"];function Yt(e,i){if(e&1){let t=C();m(0,"smart-toolbar",7,2),b("action",function(a){u(t);let _=o(3);return f(_.execute(a))}),s()}if(e&2){let t=o(3);r("fields",t.content.toolbar)("values",t.toolbarValue)}}function Zt(e,i){if(e&1){let t=C();m(0,"button",9),b("click",function(){u(t);let a=o(4);return f(a.load())}),x(1,"span",10),c(2," \u5237\u65B0 "),s()}if(e&2){let t=o(4);l(),r("nzSpin",t.loading)}}function te(e,i){if(e&1&&p(0,Zt,3,1,"button",8),e&2){let t=o(3);r("ngIf",t.content.load_api||t.content.search||t.content.search_api)}}function ee(e,i){if(e&1){let t=C();m(0,"nz-card",4),p(1,Yt,2,2,"smart-toolbar",5),m(2,"smart-table",6,0),b("query",function(a){u(t);let _=o(2);return f(_.load(a))})("action",function(a){u(t);let _=o(2);return f(_.execute(a.action,a.data,a.index))}),s()(),p(4,te,1,1,"ng-template",null,1,F)}if(e&2){let t=h(5),n=o(2);r("nzTitle",n.content.title)("nzExtra",t),l(),r("ngIf",n.content.toolbar),l(),r("columns",n.content.columns)("operators",n.content.operators)("datum",n.data)("total",n.total)("loading",n.loading)}}function ne(e,i){e&1&&c(0," \u6A21\u677F\u7C7B\u578B\u5E94\u8BE5\u662Ftable ")}function ie(e,i){if(e&1&&p(0,ee,6,8)(1,ne,1,0),e&2){let t=o();T(t.content.template=="table"?0:1)}}function oe(e,i){e&1&&x(0,"nz-spin",3)}var zt=class e extends bt{toolbar;table;toolbarValue={};total=0;$event;filter={};keyword="";load(i){if(!i&&!this.$event)return;console.log("[table] search",this.page);let t=this.content;if(t){if(i?this.$event=i:i=this.$event,Object.assign(i.filter,this.filter),i.keyword={},t.keywords?.forEach(n=>{i?.keyword&&(i.keyword[n]=this.keyword)}),typeof t.search=="string"&&t.search.length>0)try{t.search=new Function("param","request",t.search)}catch(n){console.error(n)}if(Q(t.search))this.loading=!0,t.search(i,this.request).then(n=>{this.data=n.data||[],this.total=n.total||n.data?.length||0}).finally(()=>{this.loading=!1});else if(t.search_api){this.loading=!0;let n=dt(t.search_api,this.params);this.request.post(n,i).subscribe(a=>{a.error||(this.data=a.data||[],this.total=a.total||a.data?.length||0)}).add(()=>{this.loading=!1})}else super.load()}}static \u0275fac=(()=>{let i;return function(n){return(i||(i=q(e)))(n||e)}})();static \u0275cmp=k({type:e,selectors:[["app-table"]],viewQuery:function(t,n){if(t&1&&(V(Ut,5),V(Xt,5)),t&2){let a;O(a=B())&&(n.toolbar=a.first),O(a=B())&&(n.table=a.first)}},inputs:{page:"page",content:"content",params:"params",data:"data",isChild:"isChild"},features:[R],decls:2,vars:1,consts:[["table",""],["extra",""],["toolbar",""],["nzSimple",""],[3,"nzTitle","nzExtra"],[3,"fields","values","action",4,"ngIf"],[3,"query","action","columns","operators","datum","total","loading"],[3,"action","fields","values"],["nz-button","","nzType","link","class","load",3,"click",4,"ngIf"],["nz-button","","nzType","link",1,"load",3,"click"],["nz-icon","","nzType","reload",3,"nzSpin"]],template:function(t,n){t&1&&p(0,ie,2,1)(1,oe,1,0,"nz-spin",3),t&2&&T(n.content?0:1)},dependencies:[$,H,P,I,Y,U,N,Ct],styles:[".load[_ngcontent-%COMP%]{opacity:.5}.load[_ngcontent-%COMP%]:hover{opacity:1}"]})};export{zt as TableComponent};
