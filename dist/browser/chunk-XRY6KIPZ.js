import{Fb as K,Ib as X,Jb as tt,Kb as et,Lb as P,Mb as nt,i as Q,m as G}from"./chunk-BJS2GJXO.js";import{Ib as E,e as ht,g as lt,j as O,ua as H}from"./chunk-DNCYZTAJ.js";var rt=ht((q,R)=>{"use strict";(function(b,n){typeof q=="object"&&typeof R<"u"?R.exports=n():typeof define=="function"&&define.amd?define(n):(b=typeof globalThis<"u"?globalThis:b||self).dayjs=n()})(q,function(){"use strict";var b=1e3,n=6e4,u=36e5,l="millisecond",p="second",_="minute",w="hour",M="day",D="week",$="month",B="quarter",S="year",A="date",J="Invalid Date",at=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ot=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,ut={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(i){var r=["th","st","nd","rd"],t=i%100;return"["+i+(r[(t-20)%10]||r[t]||r[0])+"]"}},W=function(i,r,t){var s=String(i);return!s||s.length>=r?i:""+Array(r+1-s.length).join(t)+i},ct={s:W,z:function(i){var r=-i.utcOffset(),t=Math.abs(r),s=Math.floor(t/60),e=t%60;return(r<=0?"+":"-")+W(s,2,"0")+":"+W(e,2,"0")},m:function i(r,t){if(r.date()<t.date())return-i(t,r);var s=12*(t.year()-r.year())+(t.month()-r.month()),e=r.clone().add(s,$),a=t-e<0,o=r.clone().add(s+(a?-1:1),$);return+(-(s+(t-e)/(a?e-o:o-e))||0)},a:function(i){return i<0?Math.ceil(i)||0:Math.floor(i)},p:function(i){return{M:$,y:S,w:D,d:M,D:A,h:w,m:_,s:p,ms:l,Q:B}[i]||String(i||"").toLowerCase().replace(/s$/,"")},u:function(i){return i===void 0}},j="en",T={};T[j]=ut;var V="$isDayjsObject",U=function(i){return i instanceof z||!(!i||!i[V])},L=function i(r,t,s){var e;if(!r)return j;if(typeof r=="string"){var a=r.toLowerCase();T[a]&&(e=a),t&&(T[a]=t,e=a);var o=r.split("-");if(!e&&o.length>1)return i(o[0])}else{var h=r.name;T[h]=r,e=h}return!s&&e&&(j=e),e||!s&&j},d=function(i,r){if(U(i))return i.clone();var t=typeof r=="object"?r:{};return t.date=i,t.args=arguments,new z(t)},c=ct;c.l=L,c.i=U,c.w=function(i,r){return d(i,{locale:r.$L,utc:r.$u,x:r.$x,$offset:r.$offset})};var z=function(){function i(t){this.$L=L(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[V]=!0}var r=i.prototype;return r.parse=function(t){this.$d=function(s){var e=s.date,a=s.utc;if(e===null)return new Date(NaN);if(c.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){var o=e.match(at);if(o){var h=o[2]-1||0,f=(o[7]||"0").substring(0,3);return a?new Date(Date.UTC(o[1],h,o[3]||1,o[4]||0,o[5]||0,o[6]||0,f)):new Date(o[1],h,o[3]||1,o[4]||0,o[5]||0,o[6]||0,f)}}return new Date(e)}(t),this.init()},r.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},r.$utils=function(){return c},r.isValid=function(){return this.$d.toString()!==J},r.isSame=function(t,s){var e=d(t);return this.startOf(s)<=e&&e<=this.endOf(s)},r.isAfter=function(t,s){return d(t)<this.startOf(s)},r.isBefore=function(t,s){return this.endOf(s)<d(t)},r.$g=function(t,s,e){return c.u(t)?this[s]:this.set(e,t)},r.unix=function(){return Math.floor(this.valueOf()/1e3)},r.valueOf=function(){return this.$d.getTime()},r.startOf=function(t,s){var e=this,a=!!c.u(s)||s,o=c.p(t),h=function(F,y){var k=c.w(e.$u?Date.UTC(e.$y,y,F):new Date(e.$y,y,F),e);return a?k:k.endOf(M)},f=function(F,y){return c.w(e.toDate()[F].apply(e.toDate("s"),(a?[0,0,0,0]:[23,59,59,999]).slice(y)),e)},m=this.$W,g=this.$M,v=this.$D,Y="set"+(this.$u?"UTC":"");switch(o){case S:return a?h(1,0):h(31,11);case $:return a?h(1,g):h(0,g+1);case D:var C=this.$locale().weekStart||0,x=(m<C?m+7:m)-C;return h(a?v-x:v+(6-x),g);case M:case A:return f(Y+"Hours",0);case w:return f(Y+"Minutes",1);case _:return f(Y+"Seconds",2);case p:return f(Y+"Milliseconds",3);default:return this.clone()}},r.endOf=function(t){return this.startOf(t,!1)},r.$set=function(t,s){var e,a=c.p(t),o="set"+(this.$u?"UTC":""),h=(e={},e[M]=o+"Date",e[A]=o+"Date",e[$]=o+"Month",e[S]=o+"FullYear",e[w]=o+"Hours",e[_]=o+"Minutes",e[p]=o+"Seconds",e[l]=o+"Milliseconds",e)[a],f=a===M?this.$D+(s-this.$W):s;if(a===$||a===S){var m=this.clone().set(A,1);m.$d[h](f),m.init(),this.$d=m.set(A,Math.min(this.$D,m.daysInMonth())).$d}else h&&this.$d[h](f);return this.init(),this},r.set=function(t,s){return this.clone().$set(t,s)},r.get=function(t){return this[c.p(t)]()},r.add=function(t,s){var e,a=this;t=Number(t);var o=c.p(s),h=function(g){var v=d(a);return c.w(v.date(v.date()+Math.round(g*t)),a)};if(o===$)return this.set($,this.$M+t);if(o===S)return this.set(S,this.$y+t);if(o===M)return h(1);if(o===D)return h(7);var f=(e={},e[_]=n,e[w]=u,e[p]=b,e)[o]||1,m=this.$d.getTime()+t*f;return c.w(m,this)},r.subtract=function(t,s){return this.add(-1*t,s)},r.format=function(t){var s=this,e=this.$locale();if(!this.isValid())return e.invalidDate||J;var a=t||"YYYY-MM-DDTHH:mm:ssZ",o=c.z(this),h=this.$H,f=this.$m,m=this.$M,g=e.weekdays,v=e.months,Y=e.meridiem,C=function(y,k,I,N){return y&&(y[k]||y(s,a))||I[k].slice(0,N)},x=function(y){return c.s(h%12||12,y,"0")},F=Y||function(y,k,I){var N=y<12?"AM":"PM";return I?N.toLowerCase():N};return a.replace(ot,function(y,k){return k||function(I){switch(I){case"YY":return String(s.$y).slice(-2);case"YYYY":return c.s(s.$y,4,"0");case"M":return m+1;case"MM":return c.s(m+1,2,"0");case"MMM":return C(e.monthsShort,m,v,3);case"MMMM":return C(v,m);case"D":return s.$D;case"DD":return c.s(s.$D,2,"0");case"d":return String(s.$W);case"dd":return C(e.weekdaysMin,s.$W,g,2);case"ddd":return C(e.weekdaysShort,s.$W,g,3);case"dddd":return g[s.$W];case"H":return String(h);case"HH":return c.s(h,2,"0");case"h":return x(1);case"hh":return x(2);case"a":return F(h,f,!0);case"A":return F(h,f,!1);case"m":return String(f);case"mm":return c.s(f,2,"0");case"s":return String(s.$s);case"ss":return c.s(s.$s,2,"0");case"SSS":return c.s(s.$ms,3,"0");case"Z":return o}return null}(y)||o.replace(":","")})},r.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},r.diff=function(t,s,e){var a,o=this,h=c.p(s),f=d(t),m=(f.utcOffset()-this.utcOffset())*n,g=this-f,v=function(){return c.m(o,f)};switch(h){case S:a=v()/12;break;case $:a=v();break;case B:a=v()/3;break;case D:a=(g-m)/6048e5;break;case M:a=(g-m)/864e5;break;case w:a=g/u;break;case _:a=g/n;break;case p:a=g/b;break;default:a=g}return e?a:c.a(a)},r.daysInMonth=function(){return this.endOf($).$D},r.$locale=function(){return T[this.$L]},r.locale=function(t,s){if(!t)return this.$L;var e=this.clone(),a=L(t,s,!0);return a&&(e.$L=a),e},r.clone=function(){return c.w(this.$d,this)},r.toDate=function(){return new Date(this.valueOf())},r.toJSON=function(){return this.isValid()?this.toISOString():null},r.toISOString=function(){return this.$d.toISOString()},r.toString=function(){return this.$d.toUTCString()},i}(),Z=z.prototype;return d.prototype=Z,[["$ms",l],["$s",p],["$m",_],["$H",w],["$W",M],["$M",$],["$y",S],["$D",A]].forEach(function(i){Z[i[1]]=function(r){return this.$g(r,i[0],i[1])}}),d.extend=function(i,r){return i.$i||(i(r,z,d),i.$i=!0),d},d.locale=L,d.isDayjs=U,d.unix=function(i){return d(1e3*i)},d.en=T[j],d.Ls=T,d.p={},d})});var it=lt(rt());var st=class b{dayjs=it.default;request=H(K);modal=H(tt);router=H(G);title=H(Q);modelRef=H(X,{optional:!0});page;_params;set params(n){this._params=n,this.load()}get params(){return this._params}content;isChild=!1;data=[];loading=!1;auto_refresh_interval=0;constructor(){}ngAfterViewInit(){this.init()}ngOnInit(){}ngOnDestroy(){this.unmount()}mount(){if(this.onMount?.call(this),typeof this.content?.auto_refresh=="number"&&this.content.auto_refresh>0&&(this.auto_refresh_interval=setInterval(()=>this.load(),this.content.auto_refresh*1e3)),typeof this.content?.mount=="string"&&this.content.mount.length>0)try{this.content.mount=new Function(this.content.mount)}catch(n){console.error(n)}O(this.content?.mount)&&this.content?.mount.call(this)}unmount(){if(this.onUnmount?.call(this),this.auto_refresh_interval&&clearInterval(this.auto_refresh_interval),typeof this.content?.unmount=="string"&&this.content.unmount.length>0)try{this.content.unmount=new Function(this.content.unmount)}catch(n){console.error(n)}O(this.content?.unmount)&&this.content?.unmount.call(this)}init(){this.content?(this.build(),this.mount(),this.load()):this.page&&this.load_page()}load_page(){console.log("[base] load page",this.page);let n="page/"+this.page;this.request.get(n).subscribe(u=>{u.error||(this.content=u,this.content?.title&&!this.isChild&&!this.modelRef&&this.title.setTitle(this.content.title),this.build(),this.mount(),this.load())})}build(){console.log("[base] build"),this.content?.methods!=null&&Object.keys(this.content.methods).forEach(n=>{let u=this.content?.methods?.[n];if(typeof u=="string")try{let l=new Function(u);l.bind(this),this[n]=l}catch(l){console.error(l)}else if(Array.isArray(u))try{let l=new Function(...u);l.bind(this),this[n]=l}catch(l){console.error(l)}else this[n]=u})}render(n){setTimeout(()=>{this.data=n})}load(){if(console.log("[base] load data",this.page),!!this.content&&(this.content.data&&this.render(this.content.data),this.content.load_api)){this.loading=!0;let n=P(this.content.load_api,this.params);this.request.get(n).subscribe(u=>{if(!u.error){if(this.render(u.data),typeof this.content?.load_success=="string"&&this.content.load_success.length>0)try{this.content.load_success=new Function("data",this.content.load_success)}catch(l){console.error(l)}O(this.content?.load_success)&&this.content?.load_success.call(this,u.data)}}).add(()=>{this.loading=!1})}}navigate(n){this.router.navigateByUrl(n).then()}execute(n,u,l){if(!n)return;let p=this.get_action_params(n,u||this.data,l||0);switch(n.type){case"link":let _=this.get_action_link(n,u||this.data,l||0),w=new URLSearchParams(p).toString(),M=_+"?"+w;n.external?window.open(M):this.router.navigateByUrl(M);break;case"script":if(typeof n.script=="string"&&n.script.length>0)try{n.script=new Function("data","index",n.script)}catch(D){console.error(D)}O(n.script)&&n.script.call(this,u||this.data,l||0);break;case"page":this.router.navigate(["/page/"+n.page],{queryParams:p});break;case"dialog":this.modal.create({nzContent:nt,nzWidth:"80%",nzData:{page:n.page,params:p},nzFooter:null}).afterClose.subscribe(D=>{if(typeof n.after_close=="string"&&n.after_close.length>0)try{n.after_close=new Function("result","data","index",n.after_close)}catch($){console.error($)}O(n.after_close)&&n.after_close.call(this,D,u||this.data,l||0)});break}}get_action_link(n,u,l){if(!n.link)return"";let p=P(n.link,u);if(typeof n.link_func=="string"&&n.link_func.length>0)try{n.link_func=new Function(n.link_func)}catch(_){console.error(_)}return O(n.link_func)&&(p=n.link_func.call(this,u,l)),p}get_action_params(n,u,l){let p=n.params;if(typeof n.params_func=="string"&&n.params_func.length>0)try{n.params_func=new Function("data",n.params_func)}catch(_){console.error(_)}return O(n.params_func)&&(p=n.params_func.call(this,u,l)),p}static \u0275fac=function(u){return new(u||b)};static \u0275cmp=E({type:b,selectors:[["app-template"]],inputs:{page:"page",content:"content",params:"params",data:"data",isChild:"isChild"},decls:0,vars:0,template:function(u,l){},dependencies:[et],encapsulation:2})};export{rt as a,st as b};
